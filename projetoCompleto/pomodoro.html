<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pomodoro com Lista de Tarefas</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <main>
        <h1>Pomodoro com Lista de Tarefas</h1>
        <input type="text" id="task" placeholder="Nova tarefa">
        <button id="addTask">Adicionar Tarefa</button>
        <ul id="taskList"></ul>
    </main>

    <!-- Inicialize o Firebase com sua configuração -->
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>
    <script>
        // Inicialize o Firebase com sua configuração
        var firebaseConfig = {
            apiKey: "AIzaSyBKEbvSnm0uEXBoO9EXphaIDd4muen9ZNU",
            authDomain: "lifesync-581d7.firebaseapp.com",
            databaseURL: "https://lifesync-581d7-default-rtdb.firebaseio.com",
            projectId: "lifesync-581d7",
            storageBucket: "lifesync-581d7.appspot.com",
            messagingSenderId: "910441512297",
            appId: "1:910441512297:web:d193f0df19aef739d791f8"
        };
        // Inicialize o Firebase
        firebase.initializeApp(firebaseConfig);

        // Seleciona os elementos do DOM
        const taskInput = document.getElementById('task');
        const addTaskButton = document.getElementById('addTask');
        const taskList = document.getElementById('taskList');

        console.log("Elementos do DOM selecionados:", taskInput, addTaskButton, taskList);

        // Função para parar todos os outros temporizadores
        function stopOtherTimers(currentPomodoroDiv) {
            console.log("currentPomodoroDiv:", currentPomodoroDiv);
            console.log("Parando outros temporizadores...");
            const allPomodoros = document.querySelectorAll('.pomodoro');
            console.log("Todos os outros temporizadores:", allPomodoros);
            allPomodoros.forEach(pomodoro => {
                if (pomodoro !== currentPomodoroDiv) {
                    const pauseButton = pomodoro.querySelector('.pauseButton');
                    if (pauseButton) {
                        console.log("Simulando clique no botão 'Pausar'...");
                        pauseButton.click(); // Simula um clique no botão "Pausar" para interromper o temporizador
                    }
                }
            });
        }


        // Adiciona uma nova tarefa ao clicar no botão "Adicionar Tarefa"
        addTaskButton.addEventListener('click', () => {
            console.log("Botão 'Adicionar Tarefa' clicado...");
            const user = firebase.auth().currentUser;
            if (!user) {
                alert("Você precisa estar logado para criar tarefas!");
                console.log("Nenhum usuário logado.");
                return;
            }

            const task = taskInput.value.trim();
            if (task) {
                console.log("Nova tarefa:", task);
                const li = document.createElement('li');
                li.textContent = task;

                // Armazena o tempo de início da tarefa no localStorage
                const tempoInicial = new Date().getTime();
                localStorage.setItem(task, tempoInicial.toString());

                // Div para exibir o temporizador Pomodoro
                const pomodoroDiv = document.createElement('div');
                pomodoroDiv.className = 'pomodoro';

                const minutesDisplay = document.createElement('span');
                minutesDisplay.className = 'minutes';
                minutesDisplay.textContent = '25';

                const colon = document.createElement('span');
                colon.textContent = ':';

                const secondsDisplay = document.createElement('span');
                secondsDisplay.className = 'seconds';
                secondsDisplay.textContent = '00';

                // Botões de controle do temporizador
                const startButton = document.createElement('button');
                startButton.textContent = 'Iniciar';
                const pauseButton = document.createElement('button');
                pauseButton.textContent = 'Pausar';
                pauseButton.className = 'pauseButton'; // Adiciona a classe 'pauseButton'
                const resetButton = document.createElement('button');
                resetButton.textContent = 'Resetar';

                pomodoroDiv.appendChild(minutesDisplay);
                pomodoroDiv.appendChild(colon);
                pomodoroDiv.appendChild(secondsDisplay);
                pomodoroDiv.appendChild(startButton);
                pomodoroDiv.appendChild(pauseButton);
                pomodoroDiv.appendChild(resetButton);

                li.appendChild(pomodoroDiv);

                const completeButton = document.createElement('button');
                completeButton.textContent = 'Concluir';
                completeButton.className = 'complete-btn';
                completeButton.addEventListener('click', () => {
                    console.log("Botão 'Concluir' clicado...");
                    li.classList.toggle('done');
                    if (li.classList.contains('done')) {
                        console.log("Tarefa concluída.");
                        const deleteButton = document.createElement('button');
                        deleteButton.textContent = 'Excluir';
                        deleteButton.className = 'delete-btn';
                        deleteButton.addEventListener('click', () => {
                            // Remove a tarefa da lista
                            taskList.removeChild(li);
                            // Remove o tempo da tarefa do localStorage
                            localStorage.removeItem(task);
                            console.log("Tarefa excluída.");
                        });
                        li.appendChild(deleteButton);
                    } else {
                        const deleteButton = li.querySelector('.delete-btn');
                        if (deleteButton) {
                            li.removeChild(deleteButton);
                            console.log("Exclusão da tarefa desfeita.");
                        }
                    }
                });

                li.appendChild(completeButton);
                taskList.appendChild(li);
                taskInput.value = '';

                let minutes = 25;
                let seconds = 0;
                let interval;
                let isPaused = false;
                let cycle = 0;

                // Atualiza o display do temporizador
                function updateDisplay() {
                    minutesDisplay.textContent = String(minutes).padStart(2, '0');
                    secondsDisplay.textContent = String(seconds).padStart(2, '0');
                }

                // Inicia o temporizador
                function startTimer() {
                    if (interval) clearInterval(interval);
                    interval = setInterval(() => {
                        if (!isPaused) {
                            if (seconds === 0) {
                                if (minutes === 0) {
                                    clearInterval(interval);
                                    cycle++;
                                    // Define os intervalos de descanso/trabalho
                                    if (cycle % 8 === 0) {
                                        minutes = 15;
                                        alert("Descanse por 15 minutos!");
                                    } else if (cycle % 2 === 0) {
                                        minutes = 5;
                                        alert("Descanse por 5 minutos!");
                                    } else {
                                        minutes = 25;
                                        alert("Tempo de trabalho!");
                                    }
                                    seconds = 0;
                                    updateDisplay();
                                    startTimer();
                                } else {
                                    minutes--;
                                    seconds = 59;
                                }
                            } else {
                                seconds--;
                            }
                            updateDisplay();
                        }
                    }, 1000);
                }

                // Eventos dos botões de controle do temporizador
                startButton.addEventListener('click', () => {
                    console.log("Botão 'Iniciar' clicado...");
                    isPaused = false;
                    // Parar
                    console.log("Iniciando temporizador...");
                    // Parar todos os outros temporizadores
                    stopOtherTimers(pomodoroDiv);
                    startTimer();
                });

                pauseButton.addEventListener('click', () => {
                    console.log("Botão 'Pausar' clicado...");
                    isPaused = true;
                });

                resetButton.addEventListener('click', () => {
                    console.log("Botão 'Resetar' clicado...");
                    clearInterval(interval);
                    minutes = 25;
                    seconds = 0;
                    isPaused = false;
                    cycle = 0;
                    updateDisplay();
                });

                updateDisplay();
            }
        });

        firebase.auth().onAuthStateChanged(user => {
            if (user) {
                console.log("Usuário está logado:", user);
            } else {
                console.log("Nenhum usuário está logado.");
            }
        });

    </script>
</body>

</html>